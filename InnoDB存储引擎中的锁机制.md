## 并发控制

### 读写锁

- 共享锁（shared lock），也称为读锁（S锁）
- 排它锁（exclusive lock），也成为写锁（X锁）

读锁是共享的，或者说是相互不阻塞的。写锁是排他的，也就是说一个写锁会阻塞其他的写锁和读锁。

兼容矩阵
| | S | X |

### 锁粒度

- 表锁（table lock）
- 行级锁（row lock）

表锁是mysql中最基本的策略，并且是开销最小的策略。

行级锁可以最大程度地支持并发处理，同时也带来了最大的锁开销。

### GAP锁
GAP锁不是加在记录上的，而是加在两条记录之间的位置

GAP锁，就是RR隔离级别，相对于RC隔离级别，不会出现幻读的关键。

所谓幻读，就是同一个事务，连续做两次当前读 (例如：select * from t1 where id = 10 for update;)，那么这两次当前读返回的是完全相同的记录 (记录数量一致，记录本身也一致)，第二次的当前读，不会比第一次返回更多的记录 (幻象)。

如何保证两次当前读返回一致的记录，那就需要在第一次当前读与第二次当前读之间，其他的事务不会插入新的满足条件的记录并提交。为了实现这个功能，GAP锁应运而生。


###  意向锁（Intention Lock)

意向锁分为意向读锁(IS)和意向写锁(IX)。

意向锁是表级锁，但是却表示事务正在读或写某一行记录，而不是整个表。

所以意向锁之间不会产生冲突，真正的冲突在加行锁时检查。

在给一行记录加锁前，首先要给该表加意向锁。也就是要同时加表意向锁和行锁。